### 1\. Архитектура Системы

Система состоит из трех основных компонентов, взаимодействующих через общий MQTT-брокер:

1.  **PC1 (Издатель/Publisher):** Считывает данные об освещенности с МК-сенсора через UART и публикует их в MQTT.
2.  **PC2 (Подписчик/Subscriber/Actuator):** Подписывается на данные об освещенности и отправляет команды управления светодиодом на МК-исполнитель через UART, основываясь на заданном пороге.
3.  **Monitor (Монитор):** Подписывается на все системные топики (`laboratory/greenhouse/#`) для логирования и отслеживания состояния.

-----

### 2\. MQTT-Топики

| Топик | Назначение | Участники | QoS |
| :--- | :--- | :--- | :--- |
| `laboratory/greenhouse/luminosity` | Показания освещённости (числовое значение) | PC1 (Публикует), PC2 (Подписывается) | 1 |
| `laboratory/greenhouse/status` | Системные статусы, ошибки, ответы МК | PC1, PC2 (Публикуют), Monitor (Подписывается) | 1 |

-----

### 3\. Компоненты Программного Обеспечения (Скрипты Python)

#### 3.1. `pc1_publisher_script.py` (Сенсор/Издатель)

**Описание:**
Скрипт, работающий на компьютере, подключенном к **МК-сенсору**. Он инициализирует соединение с МК через **UART** (`/dev/ttyUSB1`) и с **MQTT-брокером**.

**Логика работы:**

1.  Устанавливает соединение с MQTT и UART.
2.  Отправляет команду `'s'` МК-сенсору для начала потоковой передачи данных (streaming).
3.  В бесконечном цикле считывает строки из UART.
4.  Если строка начинается с `"SENSOR_VALUE:"`, извлекает значение освещённости и публикует его в топик `laboratory/greenhouse/luminosity`.
5.  При нажатии `Ctrl+C` отправляет команду `'q'` для остановки потока на МК.

#### 3.2. `pc2_subscriber_script.py` (Исполнитель/Подписчик)

**Описание:**
Скрипт, работающий на компьютере, подключенном к **МК-исполнителю**. Он подписывается на показания освещённости и управляет светодиодом через **UART** (`/dev/ttyUSB0`).

**Логика работы:**

1.  Устанавливает соединение с MQTT и UART.
2.  Подписывается на топик `laboratory/greenhouse/luminosity`.
3.  **Обработка сообщения (`on_message`):**
      * Считывает значение `luminosity_val`.
      * Публикует статус, включая команду и ответ МК.

#### 3.3. `monitor_script.py` (Монитор)

**Описание:**
Простой клиент, отслеживающий все события.

**Логика работы:**

1.  Подключается к MQTT-брокеру.
2.  Подписывается на `laboratory/greenhouse/#`.
3.  Выводит в консоль все входящие данные, а также генерирует сообщения-предупреждения:
      * Если освещённость ниже 100.
      * Если в топике `STATUS` обнаружено слово "Error".

-----

### 4\. Прошивки Микроконтроллеров (Arduino/C++)

#### 4.1. `sensor.ino` (МК-Сенсор)

**Назначение:** Чтение аналогового значения с фоторезистора (`A0`) и передача его через Serial.

| Команда (UART) | Действие | Ответ (Serial) | Примечание |
| :--- | :--- | :--- | :--- |
| `'p'` | Однократное чтение значения. | `SENSOR_VALUE: <value>` | |
| `'s'` | **Начать** потоковую передачу. | `STREAM_STARTED` | Поток — раз в 1000 мс (1 сек). |
| `'q'` | **Остановить** потоковую передачу. | `STREAM_STOPPED` | |

#### 4.2. `handler.ino` (МК-Исполнитель)

**Назначение:** Управление светодиодом (`PIN 13`) на основе команд, полученных через Serial.

| Команда (UART) | Действие | Ответ (Serial) |
| :--- | :--- | :--- |
| `'u'` | Включить светодиод (HIGH). | `LED_GOES_ON` | |
| `'d'` | Выключить светодиод (LOW). | `LED_GOES_OFF` | |
| `'b'` | Перевести в режим мигания. | `LED_WILL_BLINK` | Мигание с интервалом 500 мс. |

-----

### 5\. Инструкции по Настройке и Запуску

1.  **Подготовка МК:** Загрузите `sensor.ino` на МК-сенсор и `handler.ino` на МК-исполнитель. Подключите фоторезистор к `A0` сенсора и светодиод к `PIN 13` исполнителя.
2.  **Установка зависимостей:** Установите необходимые Python-библиотеки:
    ```bash
    pip install pyserial paho-mqtt
    ```
3.  **Конфигурация портов:**
      * В `pc1_publisher_script.py` замените `/dev/ttyUSB1` на актуальный порт МК-сенсора.
      * В `pc2_subscriber_script.py` замените `/dev/ttyUSB0` на актуальный порт МК-исполнителя.
4.  **Запуск:** Запускайте скрипты в следующем порядке (или одновременно в разных терминалах):
    ```bash
    python3 monitor_script.py
    python3 pc2_subscriber_script.py
    python3 pc1_publisher_script.py
    ```
5.  **Наблюдение:** Отслеживайте обмен данными и статусы в окне, где запущен `monitor_script.py`.
